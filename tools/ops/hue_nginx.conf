# enable nginx to reroute the traffic to Hue with headers
server {
    server_name localhost;
    charset utf-8;

    # for hue in http://
    listen 8001;

    # Or if running hue on https://
    ## listen 8001 ssl;
    ## ssl_certificate /opt/hue-portal/desktop/conf/https.cert;
    ## ssl_certificate_key /opt/hue-portal/desktop/conf/https.key;

    location / {
        proxy_pass https://hue;

        # Remove certain response headers from Hue
        proxy_hide_header X-Frame-Options;
        proxy_hide_header Content-Security-Policy;

        # Add more headers for CORS
        add_header Access-Control-Allow-Origin '*';
    }

    location /static/ {
        alias /opt/hue-portal/build/static/;
        include /etc/nginx/mime.types;

        expires 30d;
        add_header Cache-Control public;
    }
}

upstream hue {
    ip_hash;

    # List all the Hue instances here for high availability.
    server localhost:9999 max_fails=3;
}
